# Recovery: 뇌졸중 환자 재활 보조 애플리케이션 백엔드

2024 Google Solution Challenge 참가 프로젝트로, 뇌졸중 환자의 재활 과정을 돕는 태블릿용 애플리케이션의 REST API 서버를 개발했습니다.

---

## 👨‍💻 개발자
- **김모세**: [GitHub 프로필 링크](https://github.com/moset1)

---

## 🛠️ 기술 스택 (Tech Stack)

| 구분 | 기술 |
|---|---|
| **Language** | Java 17 |
| **Framework** | Spring Boot 3.x, Spring Security |
| **Database** | H2 (In-memory) |
| **Build Tool** | Gradle |
| **Testing** | JUnit 5, Mockito |

---

## 📖 주요 기능 (Key Features)

- **사용자 관리**: Spring Security를 이용한 안전한 회원가입 및 이메일/비밀번호 기반 로그인/로그아웃 기능
- **운동 정보 제공**: 재활에 필요한 운동의 상세 정보(주의사항, 영상 링크 등) 조회 기능
- **운동 기록 관리**: 사용자의 일일/기간별 운동 수행 기록 조회 및 신규 기록 저장 기능

---

## ⚙️ 기술적 결정 및 개선 과정

이 프로젝트는 단순히 기능을 구현하는 것을 넘어, 안정적이고 확장 가능한 API 서버를 구축하는 것을 목표로 했습니다. 테스트 주도 개발(TDD) 접근 방식을 통해 발견된 문제점들을 아래와 같이 체계적으로 개선했습니다.

### 1. DTO 도입을 통한 API 명세 안정화

#### 문제점
초기 API는 데이터베이스와 직접 매핑된 `Entity` 객체를 요청/응답에 그대로 사용했습니다. 이는 DB 스키마 변경이 API 명세에 직접적인 영향을 미치는 취약한 구조였습니다.

#### 해결 방안
`Request/Response DTO(Data Transfer Object)`를 도입하여 API의 명세와 내부 도메인 모델을 분리했습니다.
- **안정성 확보**: DB 스키마가 변경되어도 DTO를 통해 API 명세를 동일하게 유지할 수 있습니다.
- **데이터 은닉**: 클라이언트에게 불필요한 서버 내부 데이터를 노출하지 않아 보안이 향상됩니다.

### 2. 견고한 예외 처리 및 유효성 검사

#### 문제점
초기 버전은 존재하지 않는 리소스 요청, 유효성 검사 실패, 데이터 중복 등 다양한 예외 상황에 대해 모호한 `500` 또는 `400` 에러 코드를 반환했습니다. 이는 클라이언트가 오류의 원인을 파악하기 어렵게 만들었습니다.

#### 해결 방안
- **전역 예외 처리기 도입 (`@RestControllerAdvice`)**: `GlobalExceptionHandler`를 구현하여 애플리케이션 전역에서 발생하는 예외를 한 곳에서 중앙 집중적으로 관리하도록 구조를 개선했습니다.
- **상황별 예외 핸들러 구현**: 각 예외의 성격에 맞는 명확한 HTTP 상태 코드와 상세한 에러 메시지를 반환하도록 핸들러를 세분화했습니다.
  - **`ResourceNotFoundException`**: `404 Not Found` - 요청한 리소스가 존재하지 않음.
  - **`MethodArgumentNotValidException`**: `400 Bad Request` - 요청 본문의 유효성 검사 실패. 어떤 필드가 왜 실패했는지 상세 정보를 JSON으로 반환합니다. (예: `{"email": "이메일 형식이 올바르지 않습니다."}`)
  - **`DataIntegrityViolationException`**: `409 Conflict` - 데이터 무결성 제약 조건 위반 (예: 이메일 중복).

이를 통해 클라이언트가 오류 상황을 명확히 인지하고 후속 조치를 취하기 용이한, 예측 가능하고 안정적인 API를 구축했습니다.

### 3. RESTful 인증 응답 처리

#### 문제점
기본 `formLogin` 설정은 로그인 성공/실패 시 특정 URL로 리다이렉트합니다. 이는 JSON 데이터를 주고받는 REST API 환경(모바일 앱, SPA 등)에서는 클라이언트가 후속 조치를 취하기 어려운 방식입니다.

#### 해결 방안
`SecurityConfig`에서 `successHandler`와 `failureHandler`를 직접 구현하여, 페이지 리다이렉트 대신 **상태 코드와 JSON 메시지를 반환**하도록 변경했습니다.
- **로그인 성공**: `200 OK` 상태 코드와 함께 성공 메시지를 담은 JSON 응답.
- **로그인 실패**: `401 Unauthorized` 상태 코드와 함께 실패 원인을 담은 JSON 응답.

이를 통해 API 클라이언트가 인증 결과를 명확히 파악하고, 토큰 저장이나 에러 메시지 표시 등 후속 작업을 원활하게 수행할 수 있도록 API의 유연성과 사용성을 크게 향상시켰습니다.

### 4. 통합 테스트를 통한 API 신뢰도 확보

#### 문제점
단위 테스트는 각 컴포넌트의 동작을 개별적으로 검증하지만, 컨트롤러-서비스-리포지토리-데이터베이스로 이어지는 전체 흐름의 상호작용이 올바르게 동작하는지는 보장하지 못합니다.

#### 해결 방안
`@SpringBootTest`와 `MockMvc`를 사용하여 **API 통합 테스트**를 도입했습니다.
- **전체 흐름 검증**: 회원가입과 같은 핵심 API에 대해, 실제 HTTP 요청부터 데이터베이스 저장까지의 전 과정을 테스트하여 시스템의 신뢰도를 확보했습니다.
- **다양한 시나리오 테스트**: 정상적인 성공 케이스(`201 Created`)는 물론, 이메일 중복과 같은 주요 실패 케이스(`409 Conflict`)에 대해서도 정확한 상태 코드와 응답 본문을 반환하는지 검증했습니다.
- **테스트 격리**: 각 테스트는 `@Transactional`을 통해 독립적인 트랜잭션 내에서 실행되고, 종료 후 롤백되어 다른 테스트에 영향을 주지 않도록 설계했습니다.

---

## 🚀 프로젝트 실행 방법

1.  **프로젝트 클론**
    ```sh
    git clone https://github.com/your-repo/Recovery_BackEnd.git
    ```
2.  **프로젝트 실행**
    - IntelliJ IDEA와 같은 IDE에서 프로젝트를 열고, `RecoveryBackEndApplication.java` 파일을 찾아 실행합니다.
3.  **H2 데이터베이스 콘솔 접속**
    - 애플리케이션 실행 후, 웹 브라우저에서 `http://localhost:8080/h2-console`로 접속합니다.
    - **JDBC URL**: `jdbc:h2:mem:testdb`
    - **사용자명**: `sa`
    - **비밀번호**: (공백)
